<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ASH</title>
  <meta name="description">

  {% load static from staticfiles %}
  <link rel="stylesheet" href="{% static 'css/bootstrap.css' %}" >
  <link rel="stylesheet" href="{% static 'css/bootstrap-theme.min.css' %}">

  <style>
  body{
    padding-top: 30px
  }

  section{
    padding-top: 60px
  }
  </style>
</head>

<body>
  <div>
    <div class="container text-center">
      <h1>Register</h1>
    </div>
  </div>

  <!--Form to input the userid and password of the user -->
  <div class="panel panel-default" style="margin-right:15%; margin-left:15%;" align="center">
    <div class="row promo-top">
      <br>
      <p>Please provide the following information so that you can start using our
        services.</p>
        <br>
        <form enctype="multipart/form-data" id="form_register" type="POST" action="/mainApp/register/" method="post">
          {% csrf_token %}
          <div class="input-group" style="width:50%; padding:0%;">
            <span class="input-group-addon" style="width:100px; margin-top:2px; border:none; background-color:white; vertical-align:top;">Are you a(n): </span>
            {% for radio in form.client_or_subuser %}
            <div align="left" style="margin-left:20px">
                {{ radio }}
            </div>
            {% endfor %}
          </div>
          {% if form.client_or_subuser.errors %}
          <ul style="text-align: left; margin-left: 328px">
            {% for error in form.client_or_subuser.errors %}
            <li style="color:red">{{ error|escape }}</li>
            {% endfor %}
          </ul>
          {% endif %}
          <div id='family_friend' class="input-group" style="width:50%; padding:0%;">
          </div>
          <br>
          <div id='relationship' class="input-group" style="width:50%; padding:0%; display:none">
            <span class='input-group-addon' style='background-color:white; border:none; width:100px;'>Relationship</span>
            {% for choice in form.relationship_to_client %}
            <div id="relationship_choices" align="left" style="margin-left:20px">
                {{ choice }}
            </div>
            {% endfor %}
          </div>
          <br id="break" style="display:none">
          <div class="input-group" style="width:50%; padding:0%;">
            <span class="input-group-addon" style="width:100px;">User Name</span>
            {{ form.user_name }}
          </div>
          {% if form.user_name.errors %}
          <ul style="text-align: left; margin-left: 328px">
            {% for error in form.user_name.errors %}
            <li style="color:red">{{ error|escape }}</li>
            {% endfor %}
          </ul>
          {% else %}
            <br>
          {% endif %}
          <!-- <br> -->
          <div class="input-group" style="width:50%; padding:0%;">
            <span class="input-group-addon" style="width:100px">Password</span>
            {{ form.password }}
          </div>
          {% if form.password.errors %}
          <ul style="text-align: left; margin-left: 328px">
            {% for error in form.password.errors %}
            <li style="color:red">{{ error|escape }}</li>
            {% endfor %}
          </ul>
          {% else %}
            <br>
          {% endif %}
          <div class="input-group" style="width:50%; padding:0%;">
            <span class="input-group-addon" style="width:100px">First Name</span>
            {{ form.firstname }}
          </div>
          {% if form.firstname.errors %}
          <ul style="text-align: left; margin-left: 328px">
            {% for error in form.firstname.errors %}
            <li style="color:red">{{ error|escape }}</li>
            {% endfor %}
          </ul>
          {% else %}
            <br>
          {% endif %}
          <div class="input-group" style="width:50%; padding:0%;">
            <span class="input-group-addon" style="width:100px">Last Name</span>
            {{ form.lastname }}
          </div>
          {% if form.lastname.errors %}
          <ul style="text-align: left; margin-left: 328px">
            {% for error in form.lastname.errors %}
            <li style="color:red">{{ error|escape }}</li>
            {% endfor %}
          </ul>
          {% else %}
            <br>
          {% endif %}
          <div class="input-group" style="width:50%; padding:0%;">
            <span class="input-group-addon" style="width:100px">Email</span>
            {{ form.email }}
          </div>
          {% if form.email.errors %}
          <ul style="text-align: left; margin-left: 328px">
            {% for error in form.email.errors %}
            <li style="color:red">{{ error|escape }}</li>
            {% endfor %}
          </ul>
          {% else %}
            <br>
          {% endif %}
          <div class="input-group" style="width:50%; padding:0%;">
            <span class="input-group-addon" style="width:100px;">Birthdate</span>
            {{ form.birthdate }}
          </div>
          <br>
          <div class="input-group" style="width:50%; padding:0%;">
            <span class="input-group-addon" style="width:100px">Phone #</span>
            {{ form.phone_number }}
          </div>
          {% if form.phone_number.errors %}
          <ul style="text-align: left; margin-left: 328px">
            {% for error in form.phone_number.errors %}
            <li style="color:red">{{ error|escape }}</li>
            {% endfor %}
          </ul>
          {% else %}
            <br>
          {% endif %}
          <div class="input-group" style="width:50%; padding:0%;">
            <span class="input-group-addon" style="width:100px">Address</span>
            {{ form.address }}
          </div>
          {% if form.address.errors %}
          <ul style="text-align: left; margin-left: 328px">
            {% for error in form.address.errors %}
            <li style="color:red">{{ error|escape }}</li>
            {% endfor %}
          </ul>
          {% else %}
            <br>
          {% endif %}
          <div class="input-group" style="width:50%; padding:0%;">
            <span class="input-group-addon" style="width:100px;">Profile Pic</span>
            {{ form.profile_picture }}
          </div>
          {% if form.profile_picture.errors %}
          <ul style="text-align: left; margin-left: 328px">
            {% for error in form.profile_picture.errors %}
            <li style="color:red">{{ error|escape }}</li>
            {% endfor %}
          </ul>
          {% else %}
            <br>
          {% endif %}
          <br>
          <br>
          <br>
          <div class="input-group" style="width:50%; padding:0%; text-align:center">
            <input type='submit' value='Register!' id='register_button' class='btn btn-default' style='width:30%; background-color:#D3D3D3; color:black'>
          </div>
          <br>
        </form>
        <div id="form_register_error_message"></div>
      </div>
    </div>
  </body>
  </html>



  <!-- BELOW ARE ALL THE SCRIPTS -->

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script src="{% static 'js/jquery.js' %}" type="text/javascript"></script>
  <script src="{% static 'js/bootstrap.min.js' %}" type="text/javascript"></script>

  <!-- Script to get the userid and password information and perform the corresponding action -->
  <script>
  $(function() {
    var form = $('#form_register');                        // Get the form.
    var formMessages = $('#form_register_error_message');  // Get the messages div.

    $(form).submit(function(event){                // Set up an event listener for the contact form.
      event.preventDefault();                     // Stop the browser from submitting the form.
      var formData = new FormData(form[0]);
      // var formData = $(form).serialize();         // Serialize the form data.
      $.ajax({                                    // Submit the form using AJAX.
        type: 'POST',
        url: $(form).attr('action'),
        data: formData,
        cache: false,
        processData: false,
        contentType: false,
        dataType:'json',
      })
      .done(function(response){
        if(response["context"] == 'successful'){
          var message = "You have registered successfully";
          $(formMessages).html("<br><div class='alert alert-danger alert-dismissible' role='alert'><button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button>"+message+"</div>");
          window.location.assign('/mainApp/login');
        }
        else{
          console.log(response);
          alert("done");
          alert(response["context"]);
        }

      })
      .fail(function(response){
        console.log(response);
        alert("Oops! An error occured registering.");
      });
    });
  });
  </script>
  <script>
  $(document).ready(function() {
    $('input[type=radio][name=client_or_subuser]').change(function() {
        if (this.value == 'Family_Friend') {
            $('#family_friend').show();
            $('#relationship').show();
            $('#break').show();
            // $('#relationship').append("<br><br><br>");
            document.getElementById("family_friend").innerHTML =
              "<span class='input-group-addon' style='background-color:white; border:none; width:100px;'>Reference ID</span>"+
              "<input class='form-control' id='reference_id' maxlength='50' name='reference_id' style='border:1px solid #D3D3D3; border-top-left-radius: 0; border-bottom-left-radius: 0; margin-left:20px;' type='text'><br>";
        }

        else if (this.value == 'Client') {
            $('#family_friend').hide();
            $('#relationship').hide();
            $('#break').hide();
        }
    });
});
</script>
